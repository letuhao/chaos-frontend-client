### Webpack Dev Server - Stable Configuration (Do Not Break)

This project relies on webpack-dev-server to serve an in-memory `index.html` generated by HtmlWebpackPlugin. The following rules keep hot reload working and prevent 404s/CSP errors.

### Required settings (webpack.config.js)

- devServer
  - hot: true
  - open: true
  - port: 3200
  - historyApiFallback: { index: '/index.html', disableDotRule: true }
  - devMiddleware: { publicPath: '/', writeToDisk: true, index: 'index.html' }
  - static: false
  - headers:
    - Cross-Origin-Embedder-Policy: require-corp
    - Cross-Origin-Opener-Policy: same-origin
    - Content-Security-Policy: allow HMR and localhost connections:
      - default-src 'self'
      - connect-src 'self' http://localhost:3200 ws://localhost:3200
      - script-src 'self' 'unsafe-eval' 'unsafe-inline'
      - style-src 'self' 'unsafe-inline'
      - img-src 'self' data: blob:
      - font-src 'self' data:
      - worker-src 'self' blob:
      - media-src 'self' blob:
      - frame-ancestors 'self'
  - setupMiddlewares: serve a stub at `/.well-known/appspecific/com.chrome.devtools.json` to avoid noisy 404s

- HtmlWebpackPlugin
  - template: './web-assets/src/html/welcome.html'
  - filename: 'index.html'
  - inject: 'body'

### Do NOT

- Do NOT point `static.directory` to `builds/webgl` and rely on it for the SPA shell. We serve the HtmlWebpackPlugin output; `static` can stay disabled for the shell (use it only if you need extra static assets).
- Do NOT remove `historyApiFallback` or change it away from `/index.html`. Without it, `/` and deep links may 404.
- Do NOT remove `devMiddleware.index` or `writeToDisk`. Some tooling expects the file on disk; HMR still serves from memory.
- Do NOT add hardcoded `<script src="../../js/game-ui.js">` in templates. Bundles are injected automatically by HtmlWebpackPlugin.
- Do NOT tighten CSP in development. Keep the relaxed `connect-src` and HMR allowances or hot reload will fail.

### When you MUST change webpack.config.js

- Expect to restart the dev server after changing webpack.config.js. This is normal.
- Keep the items under “Required settings” intact unless you fully understand the consequences.

### Common symptoms and quick fixes

- Symptom: `GET / 404 (Not Found)`
  - Fix: Ensure HtmlWebpackPlugin is enabled and `historyApiFallback.index = '/index.html'`. Avoid serving the shell via `static.directory`.

- Symptom: CSP error like "default-src 'none'" on 404 page
  - Fix: You are hitting the browser’s default 404 page. Fix the fallback to `/index.html` and relax CSP headers as above.

- Symptom: Chrome requests `/.well-known/appspecific/com.chrome.devtools.json` and spams 404s
  - Fix: Keep the middleware stub that returns `{ ok: true }` at that path.

### Watching source files

- HMR covers files under `web-assets/src/js` and `web-assets/src/css`.
- HTML template changes will trigger a full reload (expected). Optionally use `devServer.watchFiles` for extra watch paths if needed.

### Backend/API during development

- If calling other origins, add them to `connect-src` under the CSP header for development (e.g., http://localhost:8080).

This document codifies the working setup. Changes outside these guidelines frequently cause index 404s, CSP errors, or broken HMR.


